# Week9 2024417

## 一、本周进展

## 1. 尝试给目标函数加入正则化参数

* 手动指定参数为0的方法效果不行，尝试加入L1和L2正则化项鼓励加入稀疏性，同时防止过拟合。
* 方法：Optuna超参数寻优正则化参数，在loss函数中加入两个正则化项
* 稀疏性：

1. ETS没有正则化的稀疏性

![image-20240415203446301](D:\HierarchicalCode\log_files\Typora_images\image-20240415203446301.png)

2. ETS正则化的稀疏性

![image-20240415211111611](D:\HierarchicalCode\log_files\Typora_images\image-20240415211111611.png)

* 与没加入正则化项的结果对比

  能量得分

  | Base     | EnergyScore_Opt_1 | EnergyScore_Opt_2 |
  | -------- | ----------------- | ----------------- |
  | 12136570 | 13325934          | 13257646          |
  | 10277968 | 8651292           | 8675114           |
  | 4075830  | 4251442           | 4227332           |
  | 3100978  | 3920187           | 3889387           |
  | 6948099  | 5501885           | 5502098           |
  | 2077951  | 2497542           | 2452834           |
  | 4795166  | 3917599           | 3907010           |
  | 2522785  | 1367136           | 1383466           |
  | 2717445  | 2241834           | 2232059           |
  | 8637327  | 5915562           | 5939064           |
  | 11131377 | 8944232           | 8953707           |
  | 3346062  | 2071595           | 2079484           |



​	变差函数得分：

| Base_vs     | EnergyScore_Opt_vsv_1 | EnergyScore_Opt_vsv_2 |
| ----------- | --------------------- | --------------------- |
| 1286995684  | 1406048581            | 1399237574            |
| 996743024.1 | 886512639.2           | 888887047.5           |
| 363652387.8 | 436640041.9           | 433932503.8           |
| 326192641.2 | 410477504.9           | 407009316.2           |
| 665621022.8 | 562591805.5           | 562717534.7           |
| 204148505   | 250636119.7           | 245812527.8           |
| 462432163.3 | 400420377.8           | 399235114.9           |
| 260447679.5 | 133723030.1           | 135413511.4           |
| 261969637.1 | 211618350.6           | 210632176.1           |
| 842082120.2 | 598618757.3           | 601342017.2           |
| 1032230607  | 878891522             | 879839269.2           |
| 305726174.2 | 183822162.4           | 185020014.7           |

CRPS:

| series | Basec    | EnergyScore_Optcv_1 | EnergyScore_Optcv_2 |
| ------ | -------- | ------------------- | ------------------- |
| 1      | 788.2918 | 788.2918            | 788.2918            |
| 2      | 288.4091 | 251.9872            | 252.6616            |
| 3      | 182.7609 | 175.1707            | 174.8647            |
| 4      | 406.0188 | 422.3458            | 422.514             |
| 5      | 148.5879 | 199.8               | 199.0373            |
| 6      | 327.1932 | 271.2279            | 268.6773            |
| 7      | 81.54326 | 156.783             | 156.4106            |
| 8      | 157.1492 | 150.8299            | 149.8081            |
| 9      | 163.2956 | 188.3425            | 187.763             |
| 10     | 303.6837 | 168.478             | 169.347             |
| 11     | 133.9031 | 84.84325            | 84.64783            |
| 12     | 111.8072 | 79.92214            | 79.40562            |
| 13     | 178.5408 | 177.7333            | 178.0973            |
| 14     | 52.49921 | 66.11464            | 66.01203            |
| 15     | 131.5561 | 131.6555            | 131.7219            |
| 16     | 62.43866 | 63.24442            | 63.63582            |
| 17     | 71.4932  | 91.02398            | 91.92416            |
| 18     | 72.57031 | 65.25897            | 65.01401            |
| 19     | 64.21908 | 73.50118            | 75.37869            |
| 20     | 349.7233 | 312.7911            | 312.0807            |
| 21     | 134.4857 | 128.7395            | 129.0959            |
| 22     | 114.9928 | 114.8197            | 114.0527            |
| 23     | 122.6113 | 108.3491            | 108.2909            |
| 24     | 86.07001 | 91.48583            | 91.76287            |
| 25     | 58.77073 | 64.13125            | 63.98868            |
| 26     | 64.23722 | 97.17284            | 97.08828            |
| 27     | 57.2656  | 66.25021            | 66.21518            |
| 28     | 251.6032 | 239.8517            | 238.5228            |
| 29     | 171.7146 | 101.4547            | 101.4187            |
| 30     | 46.72483 | 70.47938            | 69.77917            |
| 31     | 51.69108 | 57.68543            | 57.72722            |
| 32     | 51.49897 | 73.94458            | 74.06368            |
| 33     | 40.27815 | 64.94487            | 64.85999            |
| 34     | 124.9101 | 124.7654            | 123.6953            |
| 35     | 44.26114 | 48.38073            | 48.87164            |
| 36     | 163.8611 | 171.2284            | 170.396             |
| 37     | 63.3471  | 75.14602            | 75.39762            |
| 38     | 75.99989 | 77.76447            | 76.86198            |
| 39     | 290.4366 | 180.1566            | 180.4281            |
| 40     | 133.9031 | 84.84325            | 84.64783            |
| 41     | 32.88571 | 82.58995            | 82.19157            |
| 42     | 37.04148 | 26.94405            | 26.86817            |
| 43     | 46.98084 | 66.55232            | 66.42804            |
| 44     | 76.4001  | 85.70121            | 85.80986            |
| 45     | 78.05877 | 77.72223            | 77.71466            |
| 46     | 60.05683 | 70.34729            | 70.47               |
| 47     | 44.80609 | 39.32268            | 39.69127            |
| 48     | 33.11287 | 39.41455            | 39.38475            |
| 49     | 52.49921 | 66.11464            | 66.01203            |
| 50     | 133.0785 | 120.7634            | 119.4542            |
| 51     | 47.68329 | 109.0287            | 107.9789            |
| 52     | 47.80539 | 57.35853            | 57.34588            |
| 53     | 62.43866 | 63.24442            | 63.63582            |
| 54     | 31.24527 | 40.63849            | 40.90766            |
| 55     | 39.88341 | 45.87494            | 46.20041            |
| 56     | 30.42833 | 39.92091            | 40.057              |
| 57     | 33.56377 | 38.49315            | 38.44247            |
| 58     | 24.26995 | 44.52661            | 44.61761            |
| 59     | 62.45614 | 87.39181            | 87.43229            |
| 60     | 27.92104 | 37.46027            | 37.41719            |
| 61     | 14.3857  | 15.08087            | 14.85221            |
| 62     | 6.919007 | 5.514799            | 5.490353            |
| 63     | 7.199912 | 8.028417            | 7.7989              |
| 64     | 24.19706 | 38.21427            | 38.24273            |
| 65     | 24.24843 | 35.089              | 35.27445            |
| 66     | 42.52572 | 51.52216            | 51.75115            |
| 67     | 22.14483 | 26.79441            | 27.00018            |
| 68     | 21.58658 | 24.46929            | 24.7372             |
| 69     | 22.32035 | 34.55238            | 34.49621            |
| 70     | 28.49814 | 35.61399            | 35.59114            |
| 71     | 115.3187 | 162.4416            | 161.8471            |
| 72     | 215.2106 | 201.3154            | 201.1056            |
| 73     | 111.9685 | 93.62445            | 93.72585            |
| 74     | 79.21265 | 101.2544            | 101.0302            |
| 75     | 43.15407 | 44.76969            | 44.6752             |
| 76     | 45.64681 | 59.37656            | 59.20917            |
| 77     | 55.06288 | 58.09687            | 58.10206            |
| 78     | 36.85593 | 40.95652            | 40.25828            |
| 79     | 50.53113 | 48.52085            | 47.9452             |
| 80     | 65.34323 | 94.16613            | 93.0812             |
| 81     | 106.2174 | 120.7076            | 120.7704            |
| 82     | 47.77555 | 49.55026            | 49.69833            |
| 83     | 80.71977 | 82.59589            | 82.46211            |
| 84     | 11.58828 | 14.73842            | 14.85424            |
| 85     | 15.50158 | 21.024              | 21.19054            |
| 86     | 33.40713 | 40.39994            | 40.21683            |
| 87     | 36.62756 | 37.55204            | 37.43014            |
| 88     | 14.39621 | 21.15506            | 21.04451            |
| 89     | 19.60506 | 22.30001            | 22.38298            |
| 90     | 17.10686 | 21.86498            | 21.77724            |
| 91     | 15.66729 | 18.03885            | 18.11571            |
| 92     | 55.45054 | 76.6866             | 76.90507            |
| 93     | 37.19825 | 43.39531            | 43.44512            |
| 94     | 36.44956 | 47.78897            | 47.78269            |
| 95     | 95.68622 | 85.68941            | 85.43207            |
| 96     | 77.83122 | 74.2143             | 74.29916            |
| 97     | 166.9801 | 149.1095            | 148.1339            |
| 98     | 171.7146 | 101.4547            | 101.4187            |
| 99     | 46.72483 | 70.47938            | 69.77917            |
| 100    | 51.69108 | 57.68543            | 57.72722            |
| 101    | 24.42224 | 30.16284            | 30.2277             |
| 102    | 33.22225 | 51.41819            | 51.48911            |
| 103    | 41.5994  | 52.74809            | 52.73082            |
| 104    | 7.111153 | 17.01531            | 16.78002            |
| 105    | 71.39409 | 66.22428            | 65.71648            |
| 106    | 73.26584 | 43.22431            | 43.01293            |
| 107    | 31.71337 | 33.84829            | 33.42547            |
| 108    | 9.643545 | 10.28813            | 10.38091            |
| 109    | 17.82653 | 18.54389            | 18.66661            |
| 110    | 28.52781 | 31.34492            | 31.44564            |
| 111    | 12.04558 | 14.75605            | 14.68142            |

## 2.DeepAR实现

* 对于Tourism数据集，调用Gluonts的API实现，假定高斯分布作为似然模型，训练epoch100次大约16min

* 结果：

  分别是：BEE FBA T

  ![image-20240416171641016](D:\HierarchicalCode\log_files\Typora_images\image-20240416171641016.png)

  ## 二、问题与后续计划

  问题：

  1. DeepAR的预测效果似乎不太好，可能参数设置不到

  计划：

  1. 使用Optuna对DeepAR调参
  2. 应用到wiki中