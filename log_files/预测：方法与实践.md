# 预测：方法与实践

## 1. 入门

### 什么可以被预测

1. 我们对它的影响因素的了解程度;
2. 有多少数据是可用的;
3. 未来与过去的相似程度；
4. 预测是否会影响我们试图预测的事物。

### 预测、计划和目标

预测：是指在考虑到所有可用信息的前提下，包括**历史数据和可以影响预测的任何未来事件的知识**，尽可能准确地预言。

分为短期、中期、**长期预测**

### 决定预测什么

预测对象、预测步长、预测周期

### 预测数据和方法

定性预测、定量预测

时间序列预测：**置信区间；可解释/时间序列/混合模型**

### 预测过程的主要步骤

1. 定义问题
2. 收集数据和信息
3. EDA
4. 模型
5. 评估

### 统计预测观点

预测的越早，预测结果越不稳定

预测区间、点预测、预测分布 $$ y_{t}|I $$ 、预测值 $$ \hat{y}_{T+h|T} $$

## 2. 时间序列图形

图示化数据可以清晰地呈现数据的特征，**包括数据的形态、异常值、随时间变化情况以及变量间的相互关系**。我们在预测时应尽可能地将图中显示的特征纳入考虑。

### tsibble对象

### 时间图

### 时间序列模式

趋势、季节性、周期性

**当数据的波动是无规律时，表示序列存在周期性；如果波动的频率不变且与固定长度的时间段有关，表示序列存在季节性。一般而言，周期的长度更长、波动幅度也更大。**

### 季节图（多重季节图/子序列季节图）

### 散点图（时间序列之间的关系）

### 滞后图

### 自相关

ACF图中的趋势与季节性

### 白噪声

不存在任何自相关性的时间序列被称为**白噪声**

希望ACF趋近于0

## 3. 时间序列分解

我们认为时间序列包括三个成分：**趋势-周期项，季节项和残差项**（残差项包含时间序列中其它所有信息）

### 变换和调整

**日历、人口、通货膨胀、数学变换**

Box-Cox变换：*Box-Cox变换是将非正态因变量变换为符合正态分布*

![image-20240211003148284](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240211003148284.png)

**合理选择参数值可以使整个序列的季节变化大小大致相同，这会使预测模型更简单**。

### 时间序列成分

**趋势-周期项，季节项和残差项（加法或乘法）**

**季节调整：去除季节项**

### 移动平均

平滑移动平均(趋势周期项)：$$ \hat{T}_{t}=\frac{1}{m}\sum_{-k}^{k} y_{t+j} $$

m=2k+1，m阶移动平均

* 一般情况下，阶数越大曲线越平滑

* 简单移动平均的阶数常常是奇数阶（例如：3，5，7等），这样可以确保对称性。

* **移动平均的移动平均**：对偶数阶（例如4阶）移动平均后的序列进行2-MA，称其为：“**4阶中心移动平均**”。这是因为这样处理后的结果是对称的。

  ![image-20240214183118910](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240214183118910.png)

![image-20240214183335697](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240214183335697.png)

### 经典时间序列分解

**趋势-周期项，季节项和残差项（加法或乘法）**

**季节调整：去除季节项**

![image-20240214183733673](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240214183733673.png)

评价：**无法估计全部；过度平滑；季节趋势的变化；对异常值不够稳健**

### 官方统计机构实用的方法

x11和seats

### STL分解法

![image-20240214184243895](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240214184243895.png)

## 5. 预测的工具集

### 工作流程

![image-20240217000401829](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240217000401829.png)

### 简单的预测方法

朴素Naive、平均、漂移、季节性 Naïve 方法

### 评估预测精度

* 残差、预测误差

* MAE、RMSE、MAPE、MASE

### 评估分布预测准确性

### 交叉验证

## 6. 判断预测

一般有三种情况需要使用判断预测：（i）没有可用数据，因此统计方法不适用，判断预测是唯一可行的方法;（ii）数据可用，先进行统计预测，然后使用判断法进行调整;（iii）数据可用，分别使用统计预测和判断预测，然后将两者进行组合。需要说明的是，当数据可用时，更倾向于应用统计方法（如本书其他章节中讨论的方法），或者至少应该从统计方法入手。

## 7. 时间序列回归模型

### 线性模型与OLS

### 残差分析

1. 残差的**自相关图/直方图/时间图**
2. 伪回归现象：

**时间序列数据一般都是“不平稳的”**；也就是说，时间序列数据没有固定的均值和方差。因此我们需要解决非平稳数据对回归模型的影响，在第[9](https://otexts.com/fpp3cn/arima-cn.html#arima-cn)章，我们会详细讨论时间序列的平稳性。在这里，我们需要强调非平稳数据对回归模型的影响。

例如，图[7.12](https://otexts.com/fpp3cn/regression-evaluation-cn.html#fig:spurious)中的两个变量，它们有着相同的向上增长的趋势，它们似乎有着强正相关关系。但实际上，澳大利亚航空客运量与几内亚水稻产量无关。

### 一些有用的预测变量

* 时间趋势（线性）
* 法定节假日
* 离群点
* 季节性虚拟变量
* **干预变量**：例如竞争对手的活动、广告支出、工业行动等等都会对被预测变量产生影响
* 交易日
* 分布滞后：广告支出
* 复活节：复活节与其他大多数的假期不同，因为它不是每年在同一天举行，并且其影响可持续一段时间
* 傅里叶级数：**对于季节性虚拟变量，尤其是长季节周期**，通常可以采用傅里叶级数。让·巴普蒂斯·约瑟夫·傅里叶是一位出生于18世纪的法国数学家。他表明一定频率的一系列正弦和余弦项可以逼近任何周期函数。我们可以把傅里叶级数用于季节模式中。

### 预测变量的筛选

不推荐的方法：**散点图/P值**

* 调整的可决系数$$ R^2 $$
* 交叉检验：CV最小值
* AIC、AICc、BIC
* 最佳回归子集
* 逐步回归

### 回归预测

### 非线性回归

### 相关与因果

多重共线性

## 8. 指数平滑

使用指数平滑方法生成的预测是过去观测值的加权平均值，并且随着过去观测值离预测值距离的增大，权重呈指数型衰减。换句话说，观察值越近，相应的权重越高。该框架能够快速生成可靠的预测结果，并且适用于广泛的时间序列，这是一个巨大的优势并且对于工业应用来说非常重要

### 简单的指数平滑

适用于预测**没有明显趋势或季节因素**的数据

朴素法、平均法、简单指数平滑

![image-20240216145954812](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240216145954812.png)

### 趋势性方法

* 霍尔特线性趋势法
* 阻尼趋势法

### 季节性方法

* Holt-Winters加法模型

* Holt-Winters乘法模型
* Holt-Winters的阻尼法

### 状态空间模型估计、选择、预测（ETS）

## 9.ARIMA模型

**指数平滑模型（exponential smoothing）和ARIMA模型**是应用最为广泛的两种时间序列预测方法。与指数平滑模型针对于数据中的趋势（trend）和季节性（seasonality）不同，ARIMA模型旨在描绘数据的自回归性（autocorrelations）

## 10. 动态回归模型

加入其他解释变量，扩展ARIMA模型

## 11. 预测分层或分组时间序列

调和、点预测、概率预测

## 12. 高级预测方法

### 复杂季节性

### Prophet模型

![image-20240216231922700](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240216231922700.png)

### 向量自回归VAR

### 神经网络模型

### Bootstrapping和bagging



